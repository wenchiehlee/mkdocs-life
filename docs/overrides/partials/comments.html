{% if page.meta.comments %}
  <h2 id="__comments">{{ lang.t("meta.comments") }}</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "{{ page.canonical_url | d(config.site_url ~ page.url, true) }}"
      this.page.identifier = "{{ page.url }}"
    }

    (function() {
      var shortname = "{{ config.extra.disqus.shortname | default('') }}"
      if (!shortname) {
        console.warn("Disqus shortname is missing: set extra.disqus.shortname in mkdocs.yml")
        return
      }

      if (window.DISQUS) {
        window.DISQUS.reset({
          reload: true,
          config: disqus_config
        })
        return
      }

      var d = document, s = d.createElement("script")
      s.src = "https://" + shortname + ".disqus.com/embed.js"
      s.setAttribute("data-timestamp", +new Date())
      ;(d.head || d.body).appendChild(s)
    })()
  </script>
{% endif %}
